{% extends 'base.html' %}

{% load field_utils %}

{% block title %} - {{ model_name_plural|title }}{% endblock %}

{% include 'navbar.html' %}

{% block content %}

<h1>{{ model_name_plural|title }}</h1>
{% include 'clients/snippets/messages.html' %}
<div>
    <a href="{% url model_name|add:'_create' %}" class="btn btn-primary">Create {{ indefinite_article }} {{ model_name|title }}</a>
</div>
<br />
<form method="get">
    <input type="text" class="input-medium search-query" name="q" placeholder="{{ model_name|title }} Search" value="{{ q }}">
    {% for name, select in selects.items %}
        <label for="{{ name }}">{{ select.label }}:</label>
        <select id="{{ name }}" name="{{ name }}">
            <option value="">---------</option>
            {% for option in select.options %}
                <option value="{{ option.value }}"{% if option.selected %} selected="selected"{% endif %}>
                    {{ option.value_display }}
                </option>
            {% endfor %}
        </select>
    {% endfor %}
    <input type="submit" class="btn" value="Search">
</form>
{% if object_list %}
    <table class="table table-striped table-cover">
        {% for object in object_list %}
            {% if forloop.first %}
                <thead>
                    <tr>
                        {% for name, field_value in object.get_all_fields.items %}
                            {% if name == "id" %}
                                <th></th>
                            {% else %}
                                <th>{{ field_value.field.verbose_name }}</th>
                            {% endif %}
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
            {% endif %}
                    <tr>
                        {% for name, field_value in object.get_all_fields.items %}
                            {% if field_value.field.name == "id" %}
                                <style>
                                    .crud {
                                        width: 75px;
                                    }
                                    .crud-margin {
                                        margin-bottom: 5px;
                                    }
                                </style>
                                <td>
                                    <a href="{% url model_name|add:'_detail' field_value.value %}"><button type="button" class="btn btn-info crud crud-margin">View</button></a><br />
                                    <a href="{% url model_name|add:'_update' field_value.value %}" class="btn btn-default crud crud-margin">Update</a><br />
                                    <a href="{% url model_name|add:'_delete' field_value.value %}" class="btn btn-default crud">Delete</a>
                                </td>
                            {% elif field_value.field|get_model_field_type|is_image %}
                                <td>
                                    {% if field_value.value %}
                                        <a href="{{ field_value.value.url }}"><img width="128px" src="{% url 'get_thumbnail' 128 128 field_value.value.url %}" /></a>
                                    {% else %}
                                        <!-- No Image -->
                                    {% endif %}
                                </td>
                            {% else %}
                                <td>{{ field_value.value }}</td>
                            {% endif %}
                        {% endfor %}
                    </tr>
            {% if forloop.last %}
                </tbody>
            {% endif %}
        {% endfor %}
    </table>
{% elif q %}
    <p>There are no {{ model_name_plural|title }} for this search.</p>
{% else %}
    <p>There are no {{ model_name_plural|title }} currenty.</p>
{% endif %}
{% if is_paginated %}
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q }}{% endif %}{% for name, select in selects.items %}&{{ name }}={% for option in select.options %}{% if option.selected %}{{ option.value }}{% endif %}{% endfor %}{% endfor %}" class="btn btn-default">Previous</a>
            {% endif %}
            {% if page_obj.number %}
                <span class="current">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                </span>
            {% endif %}
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q }}{% endif %}{% for name, select in selects.items %}&{{ name }}={% for option in select.options %}{% if option.selected %}{{ option.value }}{% endif %}{% endfor %}{% endfor %}" class="btn btn-default">Next</a>
            {% endif %}
        </span>
    </div>
{% endif %}
<form method="GET" style="display: inline-block;">
    {% if q %}
        <input type="hidden" name="q" value="{{ q }}">
    {% endif %}
    {% for name, select in selects.items %}
        {% for option in select.options %}
            {% if option.selected %}
                <input type="hidden" name="{{ name }}" value="{{ option.value }}">
            {% endif %}
        {% endfor %}
    {% endfor %}
    Rows per Page: <input type="number" id="rows_per_page" name="rows_per_page" value="{{ rows_per_page }}">
    <input type="submit" class="btn" value="Paginate">
</form>
{% if not is_paginated %}<br />{% endif %}
<br />

{% endblock %}
