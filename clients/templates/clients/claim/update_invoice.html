{% extends 'base.html' %}

{% load verbose_name %}

{% block title %} - Update Invoice{% endblock %}

{% block extra_head %}
    {% now 'Y' as current_year %}
    <script>
        $(function() {
            $( "#id_payment_date" ).datepicker(
                {changeMonth: true,
                 changeYear: true,
                 yearRange: "{{ current_year|add:"-100" }}:{{ current_year|add:"5" }}"});
            $( "#id_deposit_date" ).datepicker(
                {changeMonth: true,
                 changeYear: true,
                 yearRange: "{{ current_year|add:"-100" }}:{{ current_year|add:"5" }}"});
            $( "#id_invoice_date" ).datepicker(
                {changeMonth: true,
                 changeYear: true,
                 yearRange: "{{ current_year|add:"-100" }}:{{ current_year|add:"5" }}"});
        });
    </script>
{% endblock %}

{% include 'navbar.html' %}

{% block content %}

    <h1>
        Update invoice information for: {{ invoice.claim.patient.full_name }}
    </h1>

    <form id="update_invoice_form" class="form-horizontal" method="post">
        {% csrf_token %}
        <h5>Claim</h5>
        {% with totals=invoice.claim.total_amount_quantity_claimed %}
            <p>Total Amount Claimed: {{ totals.total_amount_claimed }}</p>
            <p>Total Quantity Claimed: {{ totals.total_quantity_claimed }}</p>
        {% endwith %}
        <p>Total Expected Back: {{ invoice.claim.total_expected_back }}</p>
        {% comment %}
        {% with totals=invoice.claim.total_max_expected_back_quantity %}
            <p>Total Max Expected Back: {{ totals.total_max_expected_back }}</p>
            <p>Total Max Quantity: {{ totals.total_max_quantity }}</p>
        {% endwith %}
        {% endcomment %}
        {% if invoice.claim.insurance.benefits %}
            <h5>Insurance</h5>
            <p>
                {% verbose_field_name invoice.claim.insurance "benefits" %}:
                {{ invoice.claim.insurance.get_benefits_display }}
            </p>
        {% endif %}
        <h5>Invoice</h5>
        <fieldset>
            {{ form.non_field_errors }}
            {% for hidden in form.hidden_fields %}
                {% if hidden.errors %}
                    {{ hidden.errors }}
                {% endif %}
                {{ hidden }}
            {% endfor %}
            {% for field in form.visible_fields %}
                <div class="form-group">
                    {% if field.errors %}
                        {{ field.errors }}
                    {% endif %}
                    <div class="col-lg-10">
                        {{ field.label_tag}} {{ field }}
                    </div>
                </div>
            {% endfor %}
        </fieldset>
        <input type="submit" name="submit" value="Save" />
    </form>
    <br />

{% endblock %}
